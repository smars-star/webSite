<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>摄像头拍照和获取经纬度</title>
</head>
<body>

  
  <video id="video" width="480" height="320" autoplay playsinline>
  </video>
  <div>
    <button id="capture">拍照</button>
    <p id="showErrorMessInfoID"></p>
  </div>
  <canvas id="canvas" width="480" height="320"></canvas>
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>	
  <script>
    var video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    	  
    //访问用户媒体设备的兼容方法
    function getUserMedia(constraints, success, error) {
      if (navigator.mediaDevices.getUserMedia) {
        //最新的标准API
        navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);
      } else if (navigator.webkitGetUserMedia) {
        //webkit核心浏览器
        navigator.webkitGetUserMedia(constraints,success, error)
      } else if (navigator.mozGetUserMedia) {
        //firfox浏览器
        navigator.mozGetUserMedia(constraints, success, error);
      } else if (navigator.getUserMedia) {
        //旧版API
        navigator.getUserMedia(constraints, success, error);
      }
    }

 

    function success(stream) {
      //兼容webkit核心浏览器
      let compatibleURL = window.URL || window.webkitURL;
      //将视频流设置为video元素的源
      //console.log(stream);
      //document.getElementById("showMessInfoID").innerHTML= stream;	
      //video.src = CompatibleURL.createObjectURL(stream);
	  window.stream = stream; // only to make stream available to console
      video.srcObject = stream;
      //video.play();

	     /*
     // 旧的浏览器可能没有srcObject
     if ("srcObject" in video) {
	     video.srcObject = stream;
     } else {
	     // 防止再新的浏览器里使用它，应为它已经不再支持了
	    video.src = compatibleURL.createObjectURL(stream);
     }	  
     video.play(); */
    }

    function error(error) {
      document.getElementById("showErrorMessInfoID").innerHTML= "访问用户媒体设备失败：" + error.name +", "+ error.message);
    }
	
    if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
	//调用用户媒体设备, 访问摄像头 ；facingMode: { 'facingMode': "user" }(前置摄像头)、{ facingMode: { exact: "environment" } }后置摄像头：
	//getUserMedia({video : {width: 480, height: 320}}, success, error);
	//var constraints = { audio: true, video: { width: 480, height: 320 ,facingMode: { exact: "environment" }}};
	//var constraints = { video: true, audio: false };
	//var constraints = { audio: true ,video : {width: 480, height: 320,facingMode: { 'facingMode': "user" }}};
	var constraints = { video: {  width: 480, height: 320 ,facingMode: 'user' } , audio: false};
	getUserMedia(constraints, success, error);
   } else {
	alert('你的浏览器不支持访问用户媒体设备');
   }
	
    document.getElementById('capture').addEventListener('click', function () {
            context.drawImage(video, 0, 0, 480, 320);      
    })
  </script>


</body>
</html>
